# load the required packages
#this is my first time using them so I have to install all required packages first:)
install.packages("shiny")
install.packages("shinydashboard")
install.packages("ggplot2")
install.packages("dplyr")
install.packages("tidyr")
install.packages("shinythemes")
install.packages("stringr")
install.packages("reshape2")
install.packages("kableExtra")
install.packages("knitr")
install.packages("tidyverse")
install.packages("lubridata")
install.packages("readr")

library(shiny)
library(shinydashboard)
library(ggplot2)
library(dplyr)
library (tidyr)
library(shinythemes) 
library(stringr)
library (reshape2)
library(kableExtra)
library(knitr)
library(tidyverse)
library(lubridate)
library(readr)


#MAKING THE DATA READY FOR ANALYSIS

getwd()
list.files()

Healthroom_data1 <- readxl::read_excel("sample_data.xlsx")  
Healthroom_data1$dov <- dmy(Healthroom_data1$dov)

 

 
  gather(complain, val, complain_1:complain_4) %>%
  # NEW STEP: Remove rows where the complaint value (val) is NA
  filter(!is.na(val)) %>% 
  count(user_id, dov, val) %>%
  spread(val, n, fill = 0)
# 1. Gather the data and filter out missing/empty values
  df_long <- Healthroom_data1  %>%
    pivot_longer(
      cols = complain_1:complain_4,
      names_to = "complain_source",
      values_to = "symptoms_text"
      ) %>%
    filter(!is.na(symptoms_text) & symptoms_text != "")
  # 2. Count the frequency of each unique symptom
  total_symptoms_counts <- df_long %>%
    count(symptoms_text, sort=TRUE)
print(total_symptoms_counts)  
top_10_table <- total_symptoms_counts %>%
  top_n(10, n)
# Print the resulting table
print("--- Top 10 Reported Symptoms and Their Frequencies ---")
print(top_10_table)
ggsave(
  filename = "Top_10_Symptom_Frequencies.png",
  plot = total_symptoms_counts,
  width = 8, 
  height = 6, 
  units = "in"
)
print("Your plot has been saved as 'Top_10_Symptom_Frequencies.png' in your current working directory.")
getwd()
print(total_symptoms_counts)
ggsave(
  filename = "Top_10_Symptom_Frequencies.png",
  plot = total_symptoms_counts, # <--- THIS MUST BE THE PLOT OBJECT!
  width = 8, 
  height = 6, 
  units = "in"
)
ggsave(
  filename = "Top_10_Symptom_Frequencies.png",
  plot = symptom_plot, # <--- USE 'symptom_plot'
  width = 8, 
  height = 6, 
  units = "in"
)
# 1. Define the Top 10 Data (Assumes 'total_symptom_counts' is already loaded)
top_10_symptoms <- total_symptom_counts %>%
  top_n(10, n)
# 1. Load Libraries
library(dplyr)
library(tidyr)
library(ggplot2)

# 2. Data Transformation and Counting (THIS CREATES THE MISSING OBJECT)
total_symptom_counts <- Healthroom_data1 %>%
  pivot_longer(
    cols = complain_1:complain_4,
    names_to = "complain_source",
    values_to = "symptom_text"
  ) %>%
  # Filter out missing values (NAs) and empty strings
  filter(!is.na(symptom_text) & symptom_text != "") %>%
  
  # Calculate the total count (n) for each unique symptom
  count(symptom_text, sort = TRUE) 

print("The object 'total_symptom_counts' is now created.")
# 3. Filter for Top 10 Symptoms
# R can now find 'total_symptom_counts'
top_10_symptoms <- total_symptom_counts %>%
  top_n(10, n) 

# 4. Define the 'symptom_plot' object
symptom_plot <- ggplot(top_10_symptoms, 
                       aes(x = n, y = reorder(symptom_text, n))) +
  geom_col(fill = "#0072B2") +
  geom_text(aes(label = n),    
            hjust = -0.2, 
            size = 3.5) +
  labs(
    title = "Top 10 Most Frequent Health Complaints",
    x = "Total Count (Frequency)",
    y = "Symptom"
  ) +
  theme_minimal() +
  scale_x_continuous(expand = expansion(mult = c(0, 0.1))) 

print("The object 'symptom_plot' is now created.")
# 5. Save the defined object
ggsave(
  filename = "Top_10_Symptom_Frequencies.png",
  plot = symptom_plot, 
  width = 8, 
  height = 6, 
  units = "in"
)

print("Plot successfully saved to your working directory.")


top_3_symptoms_list <- total_symptom_counts %>%
  top_n(3, n) %>%
  pull(symptom_text)
monthly_top_3_data <- monthly_symptom_summary %>%
  filter(symptom_text %in% top_3_symptoms_list) %>%
mutate(data = ymd(paste(year, month, "01", sep="-")))  
library(dplyr)

monthly_trend_plot <- ggplot(monthly_top_3_data, 
                             aes(x = date, 
                                 y = total_symptom_count, 
                                 color = symptom_text, 
                                 group = symptom_text)) +
  geom_line(linewidth = 1.2) + # Draw the trend lines
  geom_point(size = 3) +      # Add points for clarity at each month
  
  # Set the X-axis to display months clearly
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") + 
  
  labs(
    title = "Monthly Trend of Top 3 Health Complaints",
    x = "Month of Visit",
    y = "Total Symptom Count",
    color = "Symptom"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1), # Rotate labels
    legend.position = "bottom"
  )

# Display the plot
print(monthly_trend_plot)

# 4. Save the plot to your working directory
ggsave(
  filename = "monthly_symptom_trend.png",
  plot = monthly_trend_plot, 
  width = 10, 
  height = 6, 
  units = "in"
)

#monthly symptom frequency 
#(like fever, headache, etc.) across different years (2017-2019).
#The final output is a combined visualization—a dashboard image—showing yearly comparisons and monthly trends in a single view.

Fever_2017 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Fever",
      year== "2017"
  )
 total_fever_2017_reports <- sum(Fever_2017$total_symptom_count)
 print(total_fever_2017_reports)

Fever_2018 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Fever",
    year == "2018"
    
  )
total_fever_2018_reports <- sum(Fever_2018$total_symptom_count)


Fever_2019 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Fever",
    year == "2019"
  )
total_fever_2019_reports <- sum(Fever_2019$total_symptom_count)





Headache_2017 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Headache",
    year== "2017"
  )
total_headache_2017_reports <- sum(Headache_2017$total_symptom_count)


Headache_2018 <- monthly_symptom_summary %>%
  filter( 
    symptom_text == "Headache",
    year == "2018"
    )
total_headache_2018_reports <- sum(Headache_2018$total_symptom_count)





Headache_2019 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Headache",
    year== "2019"
  )
total_headache_2019 <- sum(Headache_2019$total_symptom_count)






Stomachpain_2017 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Stomach Pain",
    year== "2017"
  )
total_stomachpain_2017 <- sum(Stomachpain_2017$total_symptom_count)


Stomachpain_2018 <- monthly_symptom_summary %>%
  filter(
    symptom_text == "Stomach Pain",
    year== "2018"
  )
total_stomachpain_2018 <- sum(Stomachpain_2018$total_symptom_count)



Stomachpain_2019 <- monthly_symptom_summary %>%
filter(
  symptom_text == "Stomach Pain",
  year== "2019"
)
total_stomachpain_2019 <- sum(Stomachpain_2019$total_symptom_count)






#visualize 


Fever_2017 %>%
  ggplot(aes(x = total_symptom_count, y = year, color = year)) +
  geom_point(size=4)+
  geom_segment(aes(x = 0, xend = total_symptom_count,yend = year))+
  labs(
    title = "Total Fever Reports In 2017",
    x = "total_symptom_counts",
    y = "year"
  ) +
  theme_minimal()
















Fever_2017 %>%
ggplot(aes(x=month, y= total_symptom_count,group = 1)) +
  geom_line(color= "steelblue",linewidth = 1)+
  labs(
    title = "Monthly Fever Report Trend in 2017",
    x = "Month",
    y = "Total Symptom Count"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(plot_2017_monthly_trend)
  )




Fever_2018 %>%
  ggplot(aes(x=month, y =total_symptom_count, group=1))+
  geom_line(color="steelblue",linewidth=1)+
  labs(
    title= "Monthly Fever Report Trend in 2018",
    x = "Month",
    y = "Total Symptom Count"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

 Fever_2019 %>%
   ggplot(aes(x=month,y=total_symptom_count, group=1))+
   geom_line(color="steelblue",linewidth = 1)+
   labs(
     title= "Monthly Fever Report Trend in 2019",
     x = "Month",
     y = "Total Symptom Count"
   ) +
   theme(axis.text.x = element_text(angle = 45, hjust = 1))
 
 
 Headache_2017 %>%
   ggplot(aes(x=month,y=total_symptom_count,group=1))+
   geom_line(color="steelblue",linewidth=1)+
   labs(
     title= "Monthly Headache Report Trend in 2017",
     x = "month",
     y = "Total Symptom Count"
     )+
   theme(axis.text.x=element_text(angle=45,hjust=1))
     
   
Headache_2018 %>%
  ggplot(aes(x=month,y=total_symptom_count,group=1))+
  geom_line(color="steelblue",linewidth=1)+
  labs(
    title= "Monthly Headache Report Trend in 2018",
    x = "month",
    y = "Total Symptom Count"
  )+
  theme(axis.text.x=element_text(angle=45,hjust=1))

Headache_2019 %>%
  ggplot(aes(x=month,y=total_symptom_count,group=1))+
  geom_line(color="steelblue",linewidth=1)+
  labs(
    title= "Monthly Headache Report Trend in 2019",
    x = "month",
    y = "Total Symptom Count"
  )+
  theme(axis.text.x=element_text(angle=45,hjust=1))

  
  
Stomachpain_2017 %>%
ggplot(aes(x = month, y= total_symptom_count, group=1))+
  geom_line(color = "steelblue", linewidth = 1) +
  labs(
    title = "Monthly Stomach Pain Trend in 2017",
    x = "Month",
    y = "Total Symptom Count"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



Stomachpain_2018 %>%
  ggplot(aes(x = month, y= total_symptom_count, group=1))+
  geom_line(color = "steelblue", linewidth = 1) +
  labs(
    title = "Monthly Stomach Pain Trend in 2018",
    x = "Month",
    y = "Total Symptom Count"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

Stomachpain_2019 %>%
  ggplot(aes(x = month, y= total_symptom_count, group=1))+
  geom_line(color = "steelblue", linewidth = 1) +
  labs(
    title = "Monthly Stomach Pain Trend in 2019",
    x = "Month",
    y = "Total Symptom Count"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#comibinig the plots so it will look like a dashboard 

# 1. Load packages
library(magick)
library(gtools) 

# 2. Get and sort the list of files
# This code finds all your plots (Rplot01.png, Rplot02.png, etc.)
plot_files <- list.files(pattern = "Rplot\\d{2}\\.png$") 
plot_files_sorted <- gtools::mixedsort(plot_files)

# 3. Load the images from disk
image_list <- lapply(plot_files_sorted, image_read) 

# 4. Combine the list of images into a multi-frame object
multi_frame_image <- do.call(c, image_list)

# 5. Create the grid layout (Montage) with larger dimensions
dashboard_montage <- multi_frame_image %>% 
  image_montage(
    tile = "4x",                    # Keep 4 columns across (adjust if needed)
    geometry = "500x350+10+10"      # INCREASED SIZE: 500 pixels wide by 350 pixels tall
  )

# 6. Save the final image using the working JPEG format
image_write(dashboard_montage, path = "Combined_Plot_Dashboard_Large.jpg", format = "jpeg")

the end 
this was my first project in R :) <3 




